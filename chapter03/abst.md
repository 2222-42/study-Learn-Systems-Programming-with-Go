# chapter 03 低レベルアクセスへの入口2： io.Reader

前章のio.Writerの対となるio.Readerを中心に、仲間のインターフェースを紹介。

書き込みに比べると読み込みのほうがトピックが多く、機能も多いため、本章の分量は多め

- io.Readerとその仲間たちの紹介(3.1)
- 少ないコード量でio.Reader からデータを効率よく読み込むための補助的な関数群の紹介(3.2)
- io.Readerとio.Writer以外の入出力インタフェースを紹介(3.3)
- io.Reader を満たす構造体で特に頻繁に使われるものの紹介（標準入力、ファイル、ソケット、メモリのバッファ）(3.4)
- バイナリ解析に便利な機能群の紹介(3.5)
- テキスト解析に便利な機能群の紹介(3.6)
- ちょっと抽象的なio.Readerの構造体の紹介(3.7)

## 3.1 io.Reader

出力先の種類（ファイルか、画面か、バッファか、ネットワークか）にかかわらず、
データを出力するという機能がGo言語のインタフェースという仕組みで抽象化されている

プログラムで外部からデータを読み込むための機能もGo 言語のインタフェースとして抽象化されている

io.Readerには、次のような形式のRead()メソッドが宣言

```
type Reader interface {
    func Read(p []byte) (n int, err error)
}
```

引数であるp は、読み込んだ内容を一時的に入れておくバッファ。あらかじめメモリを用意しておいて(make()を使うなどして)、それを使う。

読み込んだバイト数とエラーを返し、読み込んだ内容はpに格納する。

```
// 1024 バイトのバッファをmake で作る
buffer := make([]byte, 1024)
// size は実際に読み込んだバイト数、err はエラー
size, err := r.Read(buffer)
```

面倒なところ：
- バッファの管理をしつつ、何度もRead() メソッドを読んでデータを最後まで読み込むなど、読み込み処理を書くたびに同じようなコードを書かなければなりません

Goの対応：
- 低レベルなインタフェースだけでなく、それを簡単に扱うための機能も豊富に提供
- 次の節で、それらの補助機能を見る。

## 3.2 io.Readerの補助関数

### 3.2.1 読み込みの補助関数

### 3.2.2 コピーの補助関数

## 3.3 入出力に関するio.Writerとio.Reader以外のインタフェース

### 3.3.1 入出力関連の複合インタフェース

### 3.3.2 入出力関連インタフェースのキャスト

## 3.4 io.Readerを満たす構造体で、よく使うもの

### 3.4.1 標準入力

### 3.4.2 ファイル入力

### 3.4.3 ネットワーク通信の読み込み

### 3.4.4 メモリに蓄えた内容をio.Readerとして読み出すバッファ

## 3.5 バイナリ解析用のio.Reader関連機能

### 3.5.1 必要な部位を切り出すio.LimitReader／io.SectionReader

### 3.5.2 エンディアン変換

### 3.5.3 PNGファイルを分析してみる

### 3.5.4 PNG画像に秘密のテキストを入れてみる

## 3.6 テキスト解析用のio.Reader関連機能

### 3.6.1 改行／単語で区切る

### 3.6.2 データ型を指定して解析

### 3.6.3 その他の形式の決まったフォーマットの文字列の解析

## 3.7 io.Reader／io.Writerでストリームを自由に操る

## 3.8 本章のまとめと次章予告

本章ではio.Readerの仲間たちと、io.Reader と一緒に使う補助関数、具体的なサンプルをいくつか紹介

書き込みと比べると読み込みのほうが複雑な機能が求められる。知っておくべきメソッドの数は読み込みに関するもののほうが多い:

- サイズやデータの種類を推定しながら読み込んだり、
- セクションごとに読み込み処理を切り替えたり、
- 可変長データを少ないメモリでうまく読み込む必要があったり、

だから、読み込みについては補助関数の機能や種類も豊富

次章はio.Writerやio.Readerとともに、低レベルAPI として使われるチャネルについて説明

## 3.9 問題
